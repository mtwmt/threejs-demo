# Three.js 2D/3D 座標對齊問題

> 日期：2024-12-23 | 狀態：部分解決

## 問題

在 3D 動畫模型上加入「固定位置標籤 + 動態指向線」時，2D 標籤與 3D 關節無法完美對齊。

**需求**：標籤固定於螢幕右側，線條連接到會隨動畫移動的關節。

## 根本原因

| 座標系統 | 特性                   | 問題                 |
| -------- | ---------------------- | -------------------- |
| HTML/CSS | 螢幕像素座標，固定位置 | 不會跟隨 3D 物件     |
| Three.js | 世界座標，隨相機變化   | 無法對應固定螢幕位置 |

## 解決方案：3D → 2D 投影

將 3D 骨骼座標投影到 2D 螢幕座標，用 SVG 繪製連接線。

```typescript
// 核心：將 3D 座標投影到螢幕
const screenPos = worldPos.clone().project(camera);
const x = (screenPos.x * 0.5 + 0.5) * width;
const y = (-screenPos.y * 0.5 + 0.5) * height;
```

## 已知限制

1. **骨骼與視覺位置不一致**：模型的骨骼座標不一定對應視覺上的關節位置
2. **骨骼選擇困難**：自動選擇正確骨骼的邏輯複雜，需手動調整
3. **精度問題**：線條可能無法精確指向關節中心

## 替代方案

- **CSS2DObject**：標籤附加到骨骼，跟隨動畫但不固定於螢幕
- **移除線條**：只顯示標籤面板，不連線

## 相關檔案

- `JointLabels.ts` - 座標投影與線條計算
- `MotorScene.tsx` - SVG 渲染與動畫更新
